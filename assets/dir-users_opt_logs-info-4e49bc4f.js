import{_ as M,Z as _,a as g,c as Q,b as L,T as B,d as X}from"./util.time-f709c52a.js";import{z as x,e as N,k as m,o as b,c as F,i as e,l as a,I as Y,D as A,G as V,v as p,t as v,B as ee,H as te,J as O,C as q,b as ae}from"./index-6d2e3bad.js";import{a as oe,b as re,c as se,d as le,e as ne,f as de}from"./api.users_opt_logs-c4e22e63.js";import{Z as ie}from"./ZySearchForm-e4416514.js";import{i as j}from"./util.common-7559d8cb.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./server-ae9811eb.js";const ue={class:"zy-get"},pe={__name:"get-users_opt_logs-info",props:{updateData:{type:Object,default:()=>{}}},emits:["close"],setup(u,{emit:I}){const C={style:{width:"100px"}},t={span:14},r=x({form:{}}),Z=u,D=I,T=N(),y=N(!Z.updateData);y.value||(r.form=Z.updateData||{});const U=async()=>{try{const w=await T.value.validateFields();y.value||delete r.form.password,(y.value?oe:re)(Y(r.form)).then(c=>{A.success("操作成功"),D("close",!0)})}catch(w){console.log("Failed:",w)}},z=()=>{V("还没保存数据，确认退出?").then(w=>{w&&D("close")})};return(w,l)=>{const c=m("a-input"),f=m("a-form-item"),S=m("a-form");return b(),F("section",ue,[e(S,{model:r.form,class:"zy-form","label-col":C,ref_key:"formRef",ref:T,"wrapper-col":t},{default:a(()=>[e(f,{label:"操作人",name:"operator",rules:[{required:!0,message:"请输入操作人!"}]},{default:a(()=>[e(c,{value:r.form.operator,"onUpdate:value":l[0]||(l[0]=n=>r.form.operator=n),allowClear:"",placeholder:"请输入操作人"},null,8,["value"])]),_:1}),e(f,{label:"操作模块",name:"module",rules:[{required:!0,message:"请输入操作模块!"}]},{default:a(()=>[e(c,{value:r.form.module,"onUpdate:value":l[1]||(l[1]=n=>r.form.module=n),allowClear:"",placeholder:"请输入操作模块"},null,8,["value"])]),_:1}),e(f,{label:"操作平台",name:"platform",rules:[{required:!0,message:"请输入操作平台!"}]},{default:a(()=>[e(c,{value:r.form.platform,"onUpdate:value":l[2]||(l[2]=n=>r.form.platform=n),allowClear:"",placeholder:"请输入操作平台"},null,8,["value"])]),_:1}),e(f,{label:"设备IP",name:"operatorIP",rules:[{required:!0,message:"请输入设备IP!"}]},{default:a(()=>[e(c,{value:r.form.operatorIP,"onUpdate:value":l[3]||(l[3]=n=>r.form.operatorIP=n),allowClear:"",placeholder:"请输入设备IP"},null,8,["value"])]),_:1}),e(f,{label:"设备位置",name:"address",rules:[{required:!0,message:"请输入设备位置!"}]},{default:a(()=>[e(c,{value:r.form.address,"onUpdate:value":l[4]||(l[4]=n=>r.form.address=n),allowClear:"",placeholder:"请输入设备位置"},null,8,["value"])]),_:1}),e(f,{label:"操作内容",name:"content"},{default:a(()=>[e(c,{value:r.form.content,"onUpdate:value":l[5]||(l[5]=n=>r.form.content=n),allowClear:"",placeholder:"请输入操作内容"},null,8,["value"])]),_:1})]),_:1},8,["model"]),e(M,{onSave:U,onClose:z})])}}},me={class:"zy-view"},ce={__name:"view-users_opt_logs-info",props:{viewData:{type:Object,default:()=>{}}},emits:["close"],setup(u,{emit:I}){return(C,t)=>(b(),F("section",me,[e(g,null,{default:a(()=>[e(_,{label:"操作人"},{default:a(()=>[p(v(u.viewData.operator),1)]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(_,{label:"操作模块"},{default:a(()=>[p(v(u.viewData.module),1)]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(_,{label:"操作平台"},{default:a(()=>[p(v(u.viewData.platform),1)]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(_,{label:"设备IP"},{default:a(()=>[p(v(u.viewData.operatorIP),1)]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(_,{label:"设备位置"},{default:a(()=>[p(v(u.viewData.address),1)]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(_,{label:"操作内容"},{default:a(()=>[p(v(u.viewData.content),1)]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(_,{label:"createdAt"},{default:a(()=>[p(v(u.viewData.createdAt),1)]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(_,{label:"updatedAt"},{default:a(()=>[p(v(u.viewData.updatedAt),1)]),_:1})]),_:1})]))}},he={__name:"dir-users_opt_logs-info",setup(u){const I=[{title:"操作时间",dataIndex:"createdAt",key:"createdAt",align:"center"},{title:"操作人",dataIndex:"operator",key:"operator",align:"center"},{title:"操作模块",dataIndex:"module",key:"module",align:"center"},{title:"操作平台",dataIndex:"platform",key:"platform",align:"center"},{title:"设备IP",dataIndex:"operatorIP",key:"operatorIP",align:"center"},{title:"设备位置",dataIndex:"address",key:"address",align:"center"},{title:"操作内容",dataIndex:"content",key:"content",align:"center"},{title:"操作",width:225,key:"action",align:"center",fixed:"right"}],C={authorization:ee.get("token")},t=x({show:{add:!1,edit:!1,view:!1},editTitle:"编辑",activeComponent:null,updateData:{},resetData:{},viewData:{},selectedRowKeys:[],query:{params:{},pagination:{current:1,pageSize:11,total:0,hideOnSinglePage:!0},sort:{columnKey:"createdAt",order:"descend"}},dataList:[],loading:{spinning:!1,tip:"加载中"}}),r=(o=1)=>{t.query.pagination.current=o,y()},Z=()=>{r()},D=({current:o,pageSize:s})=>{t.query.pagination=x({current:o,pageSize:s}),y()},T=({columnKey:o,order:s})=>{t.query.sort=x({current:o,order:s}),y()},y=()=>{t.loading.spinning=!0,Y(t.query);let o={status:1,message:"Success.",data:{result:[{_id:"650161914e9e445193be57eb",operator:"ZY·Admin",operatorId:"64aabf3d28f413f08d51cc00",module:"系统管理/权限管理/查询",platform:"Chrome.v116",operatorIP:"0.0.0.0",address:"保留地址",content:"/v1/sys/permissions/list",createdAt:"2023-09-13T07:15:29.276Z",updatedAt:"2023-09-13T07:15:29.276Z"},{_id:"6501615b4e9e445193be57e5",operator:"ZY·Admin",operatorId:"64aabf3d28f413f08d51cc00",module:"系统管理/角色管理/查询",platform:"Chrome.v116",operatorIP:"0.0.0.0",address:"保留地址",content:"/v1/sys/roles/list",createdAt:"2023-09-13T07:14:35.804Z",updatedAt:"2023-09-13T07:14:35.804Z"},{_id:"650160ff4e9e445193be57df",operator:"ZY·Admin",operatorId:"64aabf3d28f413f08d51cc00",module:"系统管理/用户管理/查询",platform:"Chrome.v116",operatorIP:"0.0.0.0",address:"保留地址",content:"/v1/sys/users/list",createdAt:"2023-09-13T07:13:03.002Z",updatedAt:"2023-09-13T07:13:03.002Z"},{_id:"650160d34e9e445193be57d9",operator:"ZY·Admin",operatorId:"64aabf3d28f413f08d51cc00",module:"系统管理/权限管理/查询",platform:"Chrome.v116",operatorIP:"0.0.0.0",address:"保留地址",content:"/v1/sys/permissions/list",createdAt:"2023-09-13T07:12:19.479Z",updatedAt:"2023-09-13T07:12:19.479Z"},{_id:"650160b44e9e445193be57d3",operator:"ZY·Admin",operatorId:"64aabf3d28f413f08d51cc00",module:"系统管理/权限管理/查询",platform:"Chrome.v116",operatorIP:"0.0.0.0",address:"保留地址",content:"/v1/sys/permissions/list",createdAt:"2023-09-13T07:11:48.216Z",updatedAt:"2023-09-13T07:11:48.216Z"},{_id:"650160aa4e9e445193be57cd",operator:"ZY·Admin",operatorId:"64aabf3d28f413f08d51cc00",module:"系统管理/角色管理/查询",platform:"Chrome.v116",operatorIP:"0.0.0.0",address:"保留地址",content:"/v1/sys/roles/list",createdAt:"2023-09-13T07:11:38.346Z",updatedAt:"2023-09-13T07:11:38.346Z"},{_id:"650160904e9e445193be57c7",operator:"ZY·Admin",operatorId:"64aabf3d28f413f08d51cc00",module:"系统管理/角色管理/查询",platform:"Chrome.v116",operatorIP:"0.0.0.0",address:"保留地址",content:"/v1/sys/roles/list",createdAt:"2023-09-13T07:11:12.079Z",updatedAt:"2023-09-13T07:11:12.079Z"},{_id:"650160814e9e445193be57c1",operator:"ZY·Admin",operatorId:"64aabf3d28f413f08d51cc00",module:"系统管理/用户管理/查询",platform:"Chrome.v116",operatorIP:"0.0.0.0",address:"保留地址",content:"/v1/sys/users/list",createdAt:"2023-09-13T07:10:57.006Z",updatedAt:"2023-09-13T07:10:57.006Z"},{_id:"6501607e4e9e445193be57bb",operator:"ZY·Admin",operatorId:"64aabf3d28f413f08d51cc00",module:"系统管理/角色管理/查询",platform:"Chrome.v116",operatorIP:"0.0.0.0",address:"保留地址",content:"/v1/sys/roles/list",createdAt:"2023-09-13T07:10:54.374Z",updatedAt:"2023-09-13T07:10:54.374Z"},{_id:"650160704e9e445193be57b5",operator:"ZY·Admin",operatorId:"64aabf3d28f413f08d51cc00",module:"系统管理/用户管理/查询",platform:"Chrome.v116",operatorIP:"0.0.0.0",address:"保留地址",content:"/v1/sys/users/list",createdAt:"2023-09-13T07:10:40.665Z",updatedAt:"2023-09-13T07:10:40.665Z"},{_id:"65015fd44e9e445193be57af",operator:"ZY·Admin",operatorId:"64aabf3d28f413f08d51cc00",module:"系统管理/用户管理/查询",platform:"Chrome.v116",operatorIP:"0.0.0.0",address:"保留地址",content:"/v1/sys/users/list",createdAt:"2023-09-13T07:08:04.650Z",updatedAt:"2023-09-13T07:08:04.650Z"}],current:1,pageSize:11,total:884},time:1694589406678};t.loading.spinning=!1;let s=o.data.result;for(const d of s)d.createdAt=B.formatTime(d.createdAt),d.updatedAt=B.formatTime(d.updatedAt);t.dataList=s,t.query.pagination.total=o.data.total,t.query.pagination.current=o.data.current,t.query.pagination.pageSize=o.data.pageSize},U=o=>{t.selectedRowKeys=o},z=(o,s,d)=>{j(o)||D(o),j(d)||T(d)},w=o=>{t.show.view=!0,t.viewData=o},l=o=>{t.show.edit=!0,o&&o._id?t.editTitle="修改操作日志":t.editTitle="添加操作日志",t.updateData=o},c=()=>{t.loading.spinning=!0;let o=Y(t.query);le(o).then(s=>{t.loading.spinning=!1}).catch(s=>{t.loading.spinning=!1,console.log(s)})},f=({file:o})=>{o.status==="error"&&A.error(o.response.message||"导入失败"),o.status==="done"&&(A.success(o.response.message||"上传成功"),r())},S=()=>{ne().then(o=>{t.loading.spinning=!1}).catch(o=>{t.loading.spinning=!1,console.log(o)})},n=()=>{V("确认删除数据?").then(o=>{o&&se({ids:t.selectedRowKeys||[]}).then(s=>{A.success("删除成功"),r()})})},G=o=>{V("确认删除该条数据?").then(s=>{s&&de(o).then(d=>{A.success("删除成功"),r()})})},P=o=>{t.show.reset=!1,t.show.view=!1,t.show.edit=!1,o&&r()};return r(),(o,s)=>{const d=m("a-input"),k=m("a-form-item"),R=m("IconFont"),E=m("a-button"),W=m("a-upload"),H=m("a-image"),J=m("a-table"),$=te("permission");return b(),F("section",null,[e(ie,{formValue:t.query.params,onSubmit:r,onReset:Z},{default:a(()=>[e(k,{name:"operator"},{default:a(()=>[e(d,{value:t.query.params.operator,"onUpdate:value":s[0]||(s[0]=i=>t.query.params.operator=i),allowClear:"",placeholder:"请输入操作人",onPressEnter:r,autocomplete:"off"},null,8,["value"])]),_:1}),e(k,{name:"module"},{default:a(()=>[e(d,{value:t.query.params.module,"onUpdate:value":s[1]||(s[1]=i=>t.query.params.module=i),allowClear:"",placeholder:"请输入操作模块",onPressEnter:r,autocomplete:"off"},null,8,["value"])]),_:1}),e(k,{name:"platform"},{default:a(()=>[e(d,{value:t.query.params.platform,"onUpdate:value":s[2]||(s[2]=i=>t.query.params.platform=i),allowClear:"",placeholder:"请输入操作平台",onPressEnter:r,autocomplete:"off"},null,8,["value"])]),_:1}),e(k,{name:"operatorIP"},{default:a(()=>[e(d,{value:t.query.params.operatorIP,"onUpdate:value":s[3]||(s[3]=i=>t.query.params.operatorIP=i),allowClear:"",placeholder:"请输入设备IP",onPressEnter:r,autocomplete:"off"},null,8,["value"])]),_:1})]),_:1},8,["formValue"]),e(Q,{onAdd:l,onDelete:n,addAuth:"sys:users_opt_logs:create",deleteText:"批量删除",deleteAuth:"sys:users_opt_logs:deleteAll"},{default:a(()=>[O((b(),q(E,{type:"primary",size:"small",onClick:c},{icon:a(()=>[e(R,{type:"icon-daochu1"})]),default:a(()=>[p(" 导出 ")]),_:1})),[[$,"sys:users_opt_logs:export"]]),O((b(),q(W,{headers:C,onChange:f,showUploadList:!1,action:"/v1/sys/users_opt_logs/import"},{default:a(()=>[e(E,{type:"primary",size:"small"},{icon:a(()=>[e(R,{type:"icon-daoru1"})]),default:a(()=>[p(" 导入 ")]),_:1})]),_:1})),[[$,"sys:users_opt_logs:import"]]),e(E,{type:"primary",size:"small",onClick:S},{icon:a(()=>[e(R,{type:"icon-down-arrow"})]),default:a(()=>[p(" 导入模板下载 ")]),_:1})]),_:1}),e(J,{"row-selection":{selectedRowKeys:t.selectedRowKeys,onChange:U},bordered:"",resizable:!0,loading:t.loading,columns:I,"row-key":i=>i._id,pagination:t.query.pagination,onChange:z,"row-class-name":(i,h)=>h%2===1?"table-striped":null,"data-source":t.dataList},{bodyCell:a(({column:i,record:h})=>[i.key==="avatar"?(b(),q(H,{key:0,width:40,src:h.avatar},null,8,["src"])):i.key==="action"?(b(),q(X,{key:1,viewAuth:"sys:users_opt_logs:list",editAuth:"sys:users_opt_logs:update",deleteAuth:"sys:users_opt_logs:delete",onView:K=>w(h),onEdit:K=>l(h),onDelete:K=>G(h)},null,8,["onView","onEdit","onDelete"])):ae("",!0)]),_:1},8,["row-selection","loading","row-key","pagination","row-class-name","data-source"]),e(L,{minWidth:650,show:t.show.edit,title:t.editTitle,key:"GetUsers_opt_logsInfo",onClose:P},{default:a(()=>[e(pe,{updateData:t.updateData,onClose:P},null,8,["updateData"])]),_:1},8,["show","title"]),e(L,{minWidth:650,show:t.show.view,title:"查看操作日志",key:"ViewUsers_opt_logsInfo",onClose:P},{default:a(()=>[e(ce,{viewData:t.viewData,onClose:P},null,8,["viewData"])]),_:1},8,["show"])])}}};export{he as default};
