import{_ as P,Z as v,a as y,b as E,T as N,c as W,d as G}from"./util.time-f709c52a.js";import{z as T,e as M,k as r,o as f,c as V,i as t,l as o,F as H,m as J,C as D,v as m,t as _,I as B,D as z,G as Z,b as Q}from"./index-6d2e3bad.js";import{a as A}from"./server-ae9811eb.js";import{Z as X}from"./ZySearchForm-e4416514.js";import{i as U}from"./util.common-7559d8cb.js";import"./_plugin-vue_export-helper-c27b6911.js";const Y=l=>A.post("/v1/dev/codes/list",l),ee=l=>A.post("/v1/dev/codes/delete",l),te=l=>A.post("/v1/dev/codes/deleteAll",l),ae=l=>A.get("/v1/dev/codes/collections",l),oe=l=>A.post("/v1/dev/codes/singleCurdFrontAndBack",l),ne={class:"zy-get"},le={__name:"get-codes-info",props:{updateData:{type:Object,default:()=>{}}},emits:["close"],setup(l,{emit:x}){const e={style:{width:"100px"}},d={span:14},i=T({form:{},collections:[]}),q=x,R=M();(()=>{ae().then(u=>{i.collections=u.data||[]})})();const k=async()=>{try{const u=await R.value.validateFields();oe(B(i.form)).then(c=>{z.success("操作成功"),q("close",!0)}).catch(c=>{z.error(c||"操作失败")})}catch(u){console.log("Failed:",u)}},F=()=>{Z("还没保存数据，确认退出?").then(u=>{u&&q("close")})};return(u,c)=>{const S=r("a-select-option"),I=r("a-select"),C=r("a-form-item"),g=r("a-input"),a=r("a-alert"),n=r("a-form");return f(),V("section",ne,[t(n,{model:i.form,class:"zy-form","label-col":e,ref_key:"formRef",ref:R,"wrapper-col":d},{default:o(()=>[t(C,{label:"模型",name:"tableName",rules:[{required:!0,message:"请选择模型!"}]},{default:o(()=>[t(I,{value:i.form.tableName,"onUpdate:value":c[0]||(c[0]=s=>i.form.tableName=s),placeholder:"请选择模型"},{default:o(()=>[(f(!0),V(H,null,J(i.collections,(s,h)=>(f(),D(S,{value:s,key:h},{default:o(()=>[m(_(s),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(C,{label:"模型备注",name:"comment",rules:[{required:!0,message:"请输入模型备注（中文）!"}]},{default:o(()=>[t(g,{value:i.form.comment,"onUpdate:value":c[1]||(c[1]=s=>i.form.comment=s),allowClear:"",placeholder:"请输入模型备注"},null,8,["value"]),t(a,{message:"模型备注：主要作为文件内的中文说明",type:"info"})]),_:1}),t(C,{label:"根权限",name:"auth",rules:[{required:!0,message:"请输入根权限!"}]},{default:o(()=>[t(g,{value:i.form.auth,"onUpdate:value":c[2]||(c[2]=s=>i.form.auth=s),allowClear:"",placeholder:"请输入根权限"},null,8,["value"]),t(a,{message:"根权限：例如页面需要建在系统管理下面则填'sys'",type:"info"})]),_:1})]),_:1},8,["model"]),t(P,{onSave:k,onClose:F})])}}},se={class:"zy-view"},ie={__name:"view-codes-info",props:{viewData:{type:Object,default:()=>{}}},emits:["close"],setup(l,{emit:x}){return(e,d)=>(f(),V("section",se,[t(y,null,{default:o(()=>[t(v,{label:"文件名称"},{default:o(()=>[m(_(l.viewData.name),1)]),_:1})]),_:1}),t(y,null,{default:o(()=>[t(v,{label:"文件类型"},{default:o(()=>[m(_(l.viewData.type),1)]),_:1})]),_:1}),t(y,null,{default:o(()=>[t(v,{label:"下载地址"},{default:o(()=>[m(_(l.viewData.url),1)]),_:1})]),_:1}),t(y,null,{default:o(()=>[t(v,{label:"备注"},{default:o(()=>[m(_(l.viewData.remark),1)]),_:1})]),_:1}),t(y,null,{default:o(()=>[t(v,{label:"_id"},{default:o(()=>[m(_(l.viewData._id),1)]),_:1})]),_:1}),t(y,null,{default:o(()=>[t(v,{label:"createdAt"},{default:o(()=>[m(_(l.viewData.createdAt),1)]),_:1})]),_:1}),t(y,null,{default:o(()=>[t(v,{label:"updatedAt"},{default:o(()=>[m(_(l.viewData.updatedAt),1)]),_:1})]),_:1})]))}},pe={__name:"dir-codes-info",setup(l){const x=[{title:"文件名称",dataIndex:"name",key:"name",align:"center"},{title:"文件类型",dataIndex:"type",key:"type",align:"center"},{title:"下载地址",dataIndex:"url",key:"url",align:"center"},{title:"备注",dataIndex:"remark",key:"remark",align:"center"},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",align:"center"},{title:"操作",key:"action",align:"center",fixed:"right"}],e=T({show:{add:!1,edit:!1,view:!1},collections:[],editTitle:"编辑",activeComponent:null,selectedRowKeys:[],updateData:{},resetData:{},viewData:{},query:{params:{},pagination:{current:1,pageSize:10,total:0,hideOnSinglePage:!0},sort:{columnKey:"createdAt",order:"descend"}},dataList:[],loading:{spinning:!1,tip:"加载中"}}),d=(a=1)=>{e.query.pagination.current=a,k()},i=()=>{d()},q=a=>{let n=document.createElement("a");n.href=a,n.click(),window.URL.revokeObjectURL(a)},R=({current:a,pageSize:n})=>{e.query.pagination=T({current:a,pageSize:n}),k()},$=({columnKey:a,order:n})=>{e.query.sort=T({current:a,order:n}),k()},k=()=>{e.loading.spinning=!0;let a=B(e.query);Y(a).then(n=>{var h;e.loading.spinning=!1;let s=((h=n.data)==null?void 0:h.result)||[];for(const b of s)b.createdAt=N.formatTime(b.createdAt),b.updatedAt=N.formatTime(b.updatedAt);e.dataList=s,e.query.pagination.total=n.data.total,e.query.pagination.current=n.data.current,e.query.pagination.pageSize=n.data.pageSize}).catch(n=>{e.loading.spinning=!1,console.log(n)})},F=a=>{e.selectedRowKeys=a},u=(a,n,s)=>{U(a)||R(a),U(s)||$(s)},c=a=>{e.show.view=!0,e.viewData=a},S=a=>{e.show.edit=!0,e.editTitle="创建代码生成",e.updateData.back=a},I=()=>{Z("确认删除数据?").then(a=>{a&&te({ids:e.selectedRowKeys||[]}).then(n=>{z.success("删除成功"),d()})})},C=a=>{Z("确认删除该条数据?").then(n=>{n&&ee(a).then(s=>{z.success("删除成功"),d()})})},g=a=>{e.show.reset=!1,e.show.view=!1,e.show.edit=!1,a&&d()};return d(),(a,n)=>{const s=r("a-alert"),h=r("a-input"),b=r("a-form-item"),K=r("a-image"),O=r("a-button"),j=r("a-table");return f(),V("section",null,[t(s,{message:"💥代码生成功能：主要是开发人员使用。可能需要结合代码进行理解功能",type:"info",style:{"margin-bottom":"10px"},closable:""}),t(X,{formValue:e.query.params,onSubmit:d,onReset:i},{default:o(()=>[t(b,{name:"name"},{default:o(()=>[t(h,{value:e.query.params.name,"onUpdate:value":n[0]||(n[0]=p=>e.query.params.name=p),allowClear:"",placeholder:"请输入文件名称",onPressEnter:d,autocomplete:"off"},null,8,["value"])]),_:1})]),_:1},8,["formValue"]),t(W,{onAdd:S,addText:"创建",onDelete:I,deleteText:"批量删除",addAuth:"dev:codes:singleCurdFrontAndBack",deleteAuth:"dev:codes:deleteAll"}),t(j,{"row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:F},bordered:"",resizable:!0,loading:e.loading,columns:x,"row-key":p=>p._id,pagination:e.query.pagination,onChange:u,"row-class-name":(p,w)=>w%2===1?"table-striped":null,"data-source":e.dataList},{bodyCell:o(({column:p,record:w})=>[p.key==="avatar"?(f(),D(K,{key:0,width:40,src:w.avatar},null,8,["src"])):p.key==="url"?(f(),D(O,{key:1,type:"primary",size:"small",onClick:L=>q(w.url)},{default:o(()=>[m("下载链接")]),_:2},1032,["onClick"])):p.key==="action"?(f(),D(G,{key:2,viewAuth:"dev:codes:list",deleteAuth:"dev:codes:delete",showEdit:!1,showView:!1,onView:L=>c(w),onEdit:L=>S(w),onDelete:L=>C(w)},null,8,["onView","onEdit","onDelete"])):Q("",!0)]),_:1},8,["row-selection","loading","row-key","pagination","row-class-name","data-source"]),(f(),D(E,{minWidth:650,show:e.show.edit,title:e.editTitle,key:e.editTitle,onClose:g},{default:o(()=>[t(le,{updateData:e.updateData,onClose:g},null,8,["updateData"])]),_:1},8,["show","title"])),t(E,{minWidth:650,show:e.show.view,title:"查看代码生成",key:"ViewCodesInfo",onClose:g},{default:o(()=>[t(ie,{viewData:e.viewData,onClose:g},null,8,["viewData"])]),_:1},8,["show"])])}}};export{pe as default};
